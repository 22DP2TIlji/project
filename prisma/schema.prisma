generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(50)
  email     String   @unique @db.VarChar(100)
  password  String   @db.VarChar(255)
  role      Role     @default(USER)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  reviews           Review[]
  routes            Route[]
  likedDestinations UserLikedDestination[]

  savedItineraries SavedItinerary[]

  @@map("users")
}

model SavedItinerary {
  id     Int @id @default(autoincrement())
  userId Int @map("user_id")

  startPoint String @map("start_point") @db.VarChar(100)
  endPoint   String @map("end_point") @db.VarChar(100)

  startLat Decimal @map("start_lat") @db.Decimal(10, 8)
  startLng Decimal @map("start_lng") @db.Decimal(11, 8)
  endLat   Decimal @map("end_lat") @db.Decimal(10, 8)
  endLng   Decimal @map("end_lng") @db.Decimal(11, 8)

  distanceKm Decimal? @map("distance_km") @db.Decimal(10, 2)
  timeMin    Int?     @map("time_min")

  createdAt DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("saved_itineraries")
}

model Destination {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(100)
  latitude    Decimal? @db.Decimal(10, 8)
  longitude   Decimal? @db.Decimal(11, 8)
  country     String?  @db.VarChar(50)
  city        String?  @db.VarChar(50)
  description String   @db.Text
  category    String?  @db.VarChar(50)
  region      String?  @db.VarChar(50)
  images      Image[]
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  likedByUsers UserLikedDestination[]
  weatherData  WeatherData[]

  @@map("destinations")
}

model Image {
  id            Int          @id @default(autoincrement())
  url           String       @db.Text
  destinationId Int?
  destination   Destination? @relation(fields: [destinationId], references: [id], onDelete: Cascade)
  createdAt     DateTime     @default(now())
}

model Accommodation {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(100)
  description String?  @db.Text
  address     String   @db.VarChar(255)
  latitude    Decimal  @db.Decimal(10, 8)
  longitude   Decimal  @db.Decimal(11, 8)
  category    String   @db.VarChar(50)
  priceRange  String?  @map("price_range") @db.VarChar(50)
  contactInfo String?  @map("contact_info") @db.Text
  images      String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("accommodations")
}

model Event {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(100)
  description String?  @db.Text
  venue       String   @db.VarChar(255)
  latitude    Decimal  @db.Decimal(10, 8)
  longitude   Decimal  @db.Decimal(11, 8)
  startDate   DateTime @map("start_date")
  endDate     DateTime @map("end_date")
  price       Decimal? @db.Decimal(10, 2)
  category    String   @db.VarChar(50)
  images      String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("events")
}

model Review {
  id         Int        @id @default(autoincrement())
  userId     Int        @map("user_id")
  objectId   Int        @map("object_id")
  objectType ObjectType
  rating     Int
  comment    String?    @db.Text
  createdAt  DateTime   @default(now()) @map("created_at")
  updatedAt  DateTime   @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id])

  @@map("reviews")
}

model Route {
  id          Int     @id @default(autoincrement())
  userId      Int     @map("user_id")
  name        String  @db.VarChar(100)
  description String? @db.Text

  startLat   Decimal  @db.Decimal(10, 8)
  startLng   Decimal  @db.Decimal(11, 8)
  endLat     Decimal  @db.Decimal(10, 8)
  endLng     Decimal  @db.Decimal(11, 8)
  distanceKm Decimal? @db.Decimal(10, 2)
  estTimeMin Int?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  user   User         @relation(fields: [userId], references: [id])
  points RoutePoint[]

  @@map("routes")
}

model RoutePoint {
  id         Int        @id @default(autoincrement())
  routeId    Int        @map("route_id")
  objectId   Int        @map("object_id")
  objectType ObjectType
  sequence   Int
  createdAt  DateTime   @default(now()) @map("created_at")

  route Route @relation(fields: [routeId], references: [id])

  @@map("route_points")
}

model TouristAttraction {
  id           Int      @id @default(autoincrement())
  name         String   @db.VarChar(100)
  description  String?  @db.Text
  address      String   @db.VarChar(255)
  latitude     Decimal  @db.Decimal(10, 8)
  longitude    Decimal  @db.Decimal(11, 8)
  category     String   @db.VarChar(50)
  workingHours String?  @map("working_hours") @db.Text
  contactInfo  String?  @map("contact_info") @db.Text
  images       String?  @db.Text
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("tourist_attractions")
}

model UserLikedDestination {
  userId        Int
  destinationId Int

  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  destination Destination @relation(fields: [destinationId], references: [id], onDelete: Cascade)

  @@id([userId, destinationId])
  @@map("user_liked_destinations")
}

model WeatherData {
  id            Int      @id @default(autoincrement())
  locationId    Int      @map("location_id")
  timestamp     DateTime @default(now()) @updatedAt
  temperature   Decimal  @db.Decimal(5, 2)
  humidity      Decimal? @db.Decimal(5, 2)
  windSpeed     Decimal? @map("wind_speed") @db.Decimal(5, 2)
  windDirection Int?     @map("wind_direction")
  pressure      Decimal? @db.Decimal(6, 2)
  precipitation Decimal? @db.Decimal(5, 2)
  createdAt     DateTime @default(now()) @map("created_at")

  location Destination @relation(fields: [locationId], references: [id])

  @@map("weather_data")
}

enum Role {
  USER
  ADMIN

}

enum ObjectType {
  attraction
  event
  accommodation
}
